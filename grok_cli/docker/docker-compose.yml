version: "3.8"

services:
  grok-sandbox:
    build:
      context: .
      dockerfile: Dockerfile.sandbox
    image: grok-cli-sandbox:latest
    container_name: grok-sandbox

    # Resource limits
    mem_limit: 2g
    cpus: 2

    # Security settings
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE

    # Read-only root filesystem (uncomment if needed)
    # read_only: true

    # Volumes
    volumes:
      - type: bind
        source: ../workspace
        target: /workspace
      - type: tmpfs
        target: /tmp
        tmpfs:
          size: 100M

    # Network
    network_mode: bridge

    # Environment
    environment:
      - PYTHONUNBUFFERED=1
      - NODE_ENV=development

    # Keep container running
    stdin_open: true
    tty: true

networks:
  default:
    name: grok-network
